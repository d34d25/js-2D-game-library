{"version":3,"file":"index.js","sources":["../src/sound.js"],"sourcesContent":["export class SoundPlayer \r\n{\r\n    constructor(url,volume = 1) \r\n    {\r\n        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n        this.gainNode = this.audioContext.createGain();\r\n        this.gainNode.gain.value = volume;\r\n        this.gainNode.connect(this.audioContext.destination);\r\n        this.currentSource;\r\n        this.url = url;\r\n        this.isPlaying = false;\r\n\r\n        this._unlocked = false;\r\n        this._unlockOnGesture(); // Set up auto-unlock\r\n    }\r\n\r\n    get volume()\r\n    {\r\n        if (this.gainNode) \r\n        {\r\n            return this.gainNode.gain.value;\r\n        }\r\n    }\r\n\r\n    _unlockOnGesture() {\r\n        const resume = async () => {\r\n            if (this.audioContext.state === \"suspended\") {\r\n                await this.audioContext.resume();\r\n                this._unlocked = true;\r\n                window.removeEventListener(\"click\", resume);\r\n                window.removeEventListener(\"keydown\", resume);\r\n            }\r\n        };\r\n        window.addEventListener(\"click\", resume);\r\n        window.addEventListener(\"keydown\", resume);\r\n    }\r\n\r\n    async resumeAudioContext() \r\n    {\r\n        if (this.audioContext.state === 'suspended') \r\n        {\r\n            await this.audioContext.resume();\r\n            console.log('AudioContext resumed');\r\n        }\r\n    }\r\n\r\n    async load() \r\n    {\r\n        const response = await fetch(this.url);\r\n        const arrayBuffer = await response.arrayBuffer();\r\n        this.audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\r\n    }\r\n\r\n\r\n    async play(options = {}) \r\n    {\r\n        await this.resumeAudioContext();\r\n\r\n        if (!this.audioBuffer) \r\n        {\r\n            console.warn('Audio not loaded. Call load() before play().');\r\n            return;\r\n        }\r\n\r\n        if (this.isPlaying) return;\r\n        \r\n        const source = this.audioContext.createBufferSource();\r\n        source.buffer = this.audioBuffer;\r\n        source.loop = options.loop ?? false;\r\n\r\n        source.connect(this.gainNode);\r\n        source.start(0);\r\n\r\n        this.currentSource = source;\r\n        this.isPlaying = true;\r\n\r\n        source.onended = () => {\r\n            this.isPlaying = false;\r\n            this.currentSource = null;\r\n        };\r\n\r\n        return source;\r\n    }\r\n\r\n    stop() \r\n    {\r\n        if (this.currentSource) \r\n        {\r\n            this.currentSource.stop();\r\n            this.currentSource = null;\r\n            this.isPlaying = false;\r\n        }\r\n    }\r\n\r\n    async resume() \r\n    {\r\n        if (this.audioContext.state === 'suspended') {\r\n            await this.audioContext.resume();\r\n        }\r\n    }\r\n\r\n\r\n    setVolume(value) \r\n    {\r\n        if(!this.isPlaying) return;\r\n\r\n        value = Math.min(Math.max(value, 0), 1);\r\n        if (this.gainNode) \r\n        {\r\n            this.gainNode.gain.value = value;\r\n            if (this.gainNode.gain.value < 0) this.gainNode.gain.value = 0;\r\n            if (this.gainNode.gain.value > 1) this.gainNode.gain.value = 1;\r\n        }\r\n        \r\n    }\r\n\r\n    fadeVolume(value) \r\n    {\r\n        if(!this.isPlaying) return;\r\n\r\n        if (this.gainNode) \r\n        {\r\n            this.gainNode.gain.value += value;\r\n            if (this.gainNode.gain.value <= 0) this.gainNode.gain.value = 0;\r\n            if (this.gainNode.gain.value >= 1) this.gainNode.gain.value = 1;\r\n        }\r\n\r\n    }\r\n\r\n}\r\n"],"names":[],"mappings":"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"}